{"version":3,"file":"browser.js","sources":["../src/file/path.ts","../src/critical/fontscript.ts","../src/critical/extract.ts","../src/file/download.ts","../src/browser.ts"],"sourcesContent":["\nexport function resolve(path: string, from: string): string {\n\n    if (path.match(/^['\"]?data:/)) {\n\n        return path;\n    }\n\n    // @ts-ignore\n    const baseURL: URL = new URL(from, window.location);\n    const pathURL: URL = new URL(path, baseURL);\n\n    if (baseURL.protocol != pathURL.protocol ||\n        baseURL.host != pathURL.host ||\n        pathURL.host != window.location.host ||\n        baseURL.port != pathURL.port ||\n        pathURL.port != window.location.port ||\n        baseURL.port != pathURL.port ||\n        pathURL.protocol != window.location.protocol\n    ) {\n\n        return pathURL.toString();\n    }\n\n    return pathURL.pathname + pathURL.search + pathURL.hash;\n}","import {FontObject} from \"../@types\";\n\nexport function fontscript(fonts: FontObject[]): string {\n\n    return '/* font preloader script: ' + fonts.length + ' */\\n\"fonts\" in document && ' + JSON.stringify([...fonts], null, 1) + '.forEach(font => new FontFace(font.fontFamily, font.src, font.properties).load().then(font => document.fonts.add(font)))'\n}","import {resolve} from \"../file/path\";\nimport {fontscript} from \"./fontscript\";\nimport {\n    CriticalExtractOptions,\n    CriticalResult,\n    FileMapObject,\n    FontObject,\n    MatchCSSStyleSheet,\n    RuleList\n} from \"../@types\";\nimport {TransformResult} from \"@tbela99/css-parser\";\n\nfunction abortSignal() {\n\n    throw new Error(`CSS extraction aborted`);\n}\n\n/**\n * {Object} options\n * - signal {AbortSignal?} abort css extraction\n * - html {bool?} generate HTML for each viewport\n * - fonts {bool?} generate javascript to download fonts\n *\n * @returns {Promise<{styles: string[], fonts: object[], stats: object, html: string?}>}\n */\nexport async function extract(options: CriticalExtractOptions): Promise<CriticalResult> {\n\n    const document: Document = window.document;\n    const location: Location = window.location;\n    const styles: Set<string> = new Set<string>;\n    const excluded: string[] = ['all', 'print', ''];\n    const allStylesheets: MatchCSSStyleSheet[] = new Array<MatchCSSStyleSheet>();\n\n    const height = window.innerHeight;\n    const walker = document.createNodeIterator(document, NodeFilter.SHOW_ELEMENT, {acceptNode: () => NodeFilter.SHOW_ELEMENT});\n\n    const fonts: Set<RuleList> = new Set<RuleList>();\n    const fontFamilies: Set<string> = new Set;\n    const files: Map<CSSStyleSheet, FileMapObject> = new Map;\n    const weakMap: WeakMap<RuleList | CSSStyleSheet, number> = new WeakMap;\n    const nodeMap: WeakMap<Node, number> = new WeakMap;\n    let nodeCount: number = 0;\n    let k;\n    let rule: RuleList;\n    let rules: CSSRuleList;\n\n    options.signal?.addEventListener('abort', abortSignal);\n\n    performance.mark('filterStylesheets');\n\n    for (k = 0; k < document.styleSheets.length; k++) {\n\n        rule = document.styleSheets[k];\n\n        if (rule.media.mediaText === 'print' || (rule.media.mediaText !== '' && !window.matchMedia(rule.media.mediaText).matches)) {\n\n            continue;\n        }\n\n        try {\n\n            rules = rule.cssRules || rule.rules;\n\n            for (let l = 0; l < rules.length; l++) {\n\n                allStylesheets.push({rule: rules[l], match: false})\n            }\n\n        } catch (e: any) {\n\n            console.error(JSON.stringify({'message': e.message + '\\n' + e.stack, stylesheet: rule.href}, null, 1));\n        }\n    }\n\n    performance.measure('filter stylesheets', 'filterStylesheets');\n\n    if (allStylesheets.length === 0) {\n\n        // @ts-ignore\n        return {styles: [], fonts: [], stats: {}};\n    }\n\n    let node: Element;\n    let rect;\n    let allStylesLength = allStylesheets.length;\n\n    performance.mark('nodeWalking');\n\n    // @ts-ignore\n    while ((node = walker.nextNode())) {\n\n        if (options && options.signal && options.signal.aborted) {\n\n            return Promise.reject('Aborted');\n        }\n\n        if (['SCRIPT', 'LINK', 'HEAD', 'META', 'TITLE', 'NOSCRIPT'].includes(node.tagName)) {\n\n            continue;\n        }\n\n        nodeCount++;\n        // @ts-ignore\n        rect = node.getBoundingClientRect();\n\n        if (rect.top < height) {\n\n            nodeMap.set(node, 1);\n        }\n    }\n\n    for (k = 0; k < allStylesLength; k++) {\n\n        if (allStylesheets[k].match || weakMap.has(allStylesheets[k].rule)) {\n\n            continue;\n        }\n\n        weakMap.set(allStylesheets[k].rule, 1);\n\n        if (allStylesheets[k].rule instanceof CSSStyleRule) {\n\n            // @ts-ignore\n            let selector = allStylesheets[k].rule.selectorText;\n            let match;\n\n            // detect pseudo selectors\n            if (selector.match(/(^|,|\\s)::?((before)|(after))/)) {\n\n                match = true\n            } else {\n\n                if (selector.match(/::?((before)|(after))/)) {\n\n                    selector = selector.replace(/::?((before)|(after))\\s*((,)|$)/g, '$5');\n                }\n\n                try {\n\n                    match = nodeMap.has(document.querySelector(selector));\n                } catch (e) {\n\n                    // @ts-ignore\n                    match = nodeMap.has(document.querySelector(allStylesheets[k].rule.selectorText));\n                }\n            }\n\n            if (match) {\n\n                allStylesheets[k].match = true;\n\n                // @ts-ignore\n                if (allStylesheets[k].rule.style.getPropertyValue('font-family')) {\n\n                    // @ts-ignore\n                    allStylesheets[k].rule.style.getPropertyValue('font-family').split(/\\s*,\\s*/).forEach(fontFamily => fontFamily !== 'inherit' && fontFamilies.add(fontFamily.replace(/(['\"])([^\\1\\s]+)\\1/, '$2')));\n                }\n            }\n\n        } else if (allStylesheets[k].rule instanceof CSSMediaRule || allStylesheets[k].rule instanceof CSSImportRule || allStylesheets[k].rule instanceof CSSConditionRule) {\n\n            // @ts-ignore\n            if ((allStylesheets[k].rule instanceof CSSMediaRule || allStylesheets[k].rule instanceof CSSImportRule) && (allStylesheets[k].rule.media.mediaText === 'print' || (allStylesheets[k].rule.media.mediaText !== '' && !window.matchMedia(allStylesheets[k].rule.media.mediaText).matches))) {\n                continue;\n            }\n\n            try {\n\n                const rule = allStylesheets[k].rule;\n                const rules: RuleList[] = [];\n\n                // @ts-ignore\n                const sheet = rule instanceof CSSImportRule ? rule.styleSheet.cssRules || rule.styleSheet.rules : rule.cssRules || rule.rules;\n\n                for (let l = 0; l < sheet.length; l++) {\n\n                    if (!weakMap.has(sheet[l])) {\n\n                        // @ts-ignore\n                        rules.push({rule: sheet[l], match: false})\n                    }\n                }\n\n                if (rules.length > 0) {\n\n                    // @ts-ignore\n                    allStylesheets.splice.apply(allStylesheets, [k + 1, 0].concat(rules))\n                    allStylesLength = allStylesheets.length\n                }\n            } catch (e: any) {\n\n                // @ts-ignore\n                console.error(JSON.stringify({'message': e.message + '\\n' + e.stack, stylesheet: rule.href}, null, 1));\n            }\n        } else if (allStylesheets[k].rule instanceof CSSFontFaceRule) {\n\n            // @ts-ignore\n            if (allStylesheets[k].rule.style.getPropertyValue('font-family') && allStylesheets[k].rule.style.getPropertyValue('src')) {\n\n                // @ts-ignore\n                fonts.add(allStylesheets[k].rule);\n            }\n        }\n    }\n\n    performance.measure('node walking', 'nodeWalking');\n\n    let css;\n    let file = '';\n    let inlineCount = -1;\n\n    performance.mark('rulesExtraction');\n\n    loop1:\n        for (let k = 0; k < allStylesLength; k++) {\n\n            if (!allStylesheets[k].match) {\n\n                continue;\n            }\n\n            rule = allStylesheets[k].rule;\n            let fileUpdate = false;\n\n            if (!files.has(<CSSStyleSheet>rule.parentStyleSheet)) {\n\n                //\n                files.set(<CSSStyleSheet>rule.parentStyleSheet, {\n\n                    // @ts-ignore\n                    base: (rule.parentStyleSheet.href && rule.parentStyleSheet.href.replace(/[?#].*/, '') || location.pathname).replace(/([^/]+)$/, ''),\n                    // @ts-ignore\n                    file: rule.parentStyleSheet.href || `inline style #${++inlineCount}`\n                });\n\n                fileUpdate = true;\n            } else { // @ts-ignore\n                if (file && file !== files.get(rule.parentStyleSheet).file) {\n\n                                fileUpdate = true;\n                            }\n            }\n\n            if (fileUpdate) {\n\n                // @ts-ignore\n                try {\n\n                    console.log('analysing ' + (<FileMapObject>files.get(<CSSStyleSheet>rule.parentStyleSheet)).file);\n                    styles.add('/* file: ' + (<FileMapObject>files.get(<CSSStyleSheet>rule.parentStyleSheet)).file + ' */');\n                } catch (e: any) {\n\n                    console.error(JSON.stringify(e.message + '\\n' + e.stack, null, 1));\n                    console.error(JSON.stringify(rule?.parentStyleSheet?.href, null, 1));\n                }\n            }\n\n            file = (<FileMapObject>files.get(<CSSStyleSheet>rule.parentStyleSheet)).file;\n            // @ts-ignore\n            css = rule.cssText;\n\n            if (file !== 'inline') {\n\n                // resolve url()\n                css = css.replace(/url\\(([^)%\\s]*?)\\)/g, function (all: string, one: string) {\n\n                    one = one.trim();\n\n                    if (one.match(/^['\"]?data:/)) {\n\n                        return all;\n                    }\n\n                    one = one.replace(/^(['\"])([^\\1\\s]+)\\1/, '$2');\n\n                    return 'url(' + resolve(one, (<FileMapObject>files.get(<CSSStyleSheet>rule.parentStyleSheet)).base) + ')';\n                })\n            }\n\n            // @ts-ignore\n            while (rule.parentRule) {\n\n                /**\n                 *\n                 * @type {CSSMediaRule}\n                 */\n                // @ts-ignore\n                rule = rule.parentRule;\n\n                // @ts-ignore\n                if (rule.conditionText == 'print') {\n\n                    continue loop1;\n                }\n\n                // @ts-ignore\n                if (!excluded.includes(rule.conditionText)) {\n\n                    // @ts-ignore\n                    css = '@' + rule.constructor.name.replace(/^CSS(.*?)Rule/, '$1').toLowerCase() + ' ' + rule.conditionText + ' {' + css + '}';\n                }\n\n                // @ts-ignore\n                if (!rule.parentRule) {\n\n                    break;\n                }\n            }\n\n            if (rule.parentStyleSheet) {\n\n                let media: string = rule.parentStyleSheet.media.mediaText;\n\n                if (media === 'print') {\n\n                    continue;\n                }\n\n                if (media !== '') {\n\n                    css = '@media ' + media + ' {' + css + '}';\n                }\n            }\n\n            if (styles.has(css)) {\n\n                styles.delete(css);\n            }\n\n            styles.add(css);\n        }\n\n    performance.measure('rules extraction', 'rulesExtraction');\n\n    const usedFonts: Map<string, FontObject> = new Map<string, FontObject>;\n\n    // @ts-ignore\n    if (options.fonts) {\n\n        let j;\n        let name;\n        let value;\n        let font: RuleList;\n        let fontObject: FontObject;\n        let src;\n\n        performance.mark('fontsExtraction');\n\n        for (font of fonts) {\n\n            // @ts-ignore\n            if (font.style.getPropertyValue('font-family').split(/\\s*,\\s*/).some(token => {\n\n                return fontFamilies.has(token.replace(/(['\"])([^\\1\\s]+)\\1/, '$2'));\n            })) {\n\n                // @ts-ignore\n                src = font.style.getPropertyValue('src');\n\n                if (!src) {\n\n                    continue;\n                }\n\n                fontObject = {\n                    // @ts-ignore\n                    'fontFamily': font.style.getPropertyValue('font-family').replace(/(['\"])([^\\1\\s]+)\\1/, '$2'),\n                    src: src.replace(/(^|[,\\s*])local\\([^)]+\\)\\s*,?\\s*?/g, '').replace(/url\\(([^)%\\s]+)\\)([^,]*)(,?)\\s*/g, (all: string, one: string, two: string, three: string) => {\n\n                        one = one.replace(/(['\"])([^\\1\\s]+)\\1/, '$2');\n\n                        if (!files.has(<CSSStyleSheet>font.parentStyleSheet)) {\n\n                            if (!(<CSSStyleSheet>font.parentStyleSheet).href) {\n\n                                return all;\n                            }\n\n                            files.set(<CSSStyleSheet>font.parentStyleSheet, {\n\n                                // @ts-ignore\n                                base: font.parentStyleSheet.href.replace(/([^/]+)$/, ''),\n                                // @ts-ignore\n                                file: font.parentStyleSheet.href\n                            })\n                        }\n\n                        return 'url(' + resolve(one, (<FileMapObject>files.get(<CSSStyleSheet>font.parentStyleSheet)).base) + ')' + three;\n                    }).trim(),\n                    properties: {}\n                }\n\n                // @ts-ignore\n                j = font.style.length;\n\n                while (j--) {\n\n                    // @ts-ignore\n                    name = font.style.item(j);\n                    // @ts-ignore\n                    value = font.style.getPropertyValue(name);\n\n                    name !== 'font-family' &&\n                    name !== 'src' &&\n                    value !== '' &&\n                    value !== undefined &&\n                    (fontObject.properties[name.replace(/([A-Z])/g, (all: string, name: string) => '-' + name.toLowerCase())] = value)\n                }\n\n                usedFonts.set(JSON.stringify(fontObject), fontObject)\n            }\n        }\n\n        performance.measure('fonts extraction', 'fontsExtraction');\n    }\n\n    const stats = performance.getEntriesByType(\"measure\").filter(entry => ['filter stylesheets', 'node walking', 'rules extraction', 'fonts extraction'].includes(entry.name)).map(entry => {\n\n        return {\n\n            name: entry.name,\n\n            duration: (entry.duration / 1000).toFixed(3) + 's'\n        }\n    });\n\n\n    const result: CriticalResult = {\n        styles: [...styles],\n        fonts: <FontObject[]>[...usedFonts.values()],\n        nodeCount,\n        stats: {nodeCount, stats}\n    };\n\n    if (options.html) {\n\n        if (!document.querySelector('base')) {\n\n            const base: HTMLBaseElement = document.createElement('base');\n\n            base.href = location.protocol + '//' + location.host + location.pathname;\n            document.head.insertBefore(base, document.querySelector('meta[charset]')?.nextElementSibling || document.head.firstChild)\n        }\n\n        if (!document.querySelector('meta[charset]')) {\n\n            const meta: HTMLMetaElement = document.createElement('meta');\n            meta.setAttribute('charset', 'utf-8');\n            document.head.insertBefore(meta, document.head.firstChild)\n        }\n\n        Array.from((<NodeListOf<HTMLStyleElement | HTMLLinkElement>>document.querySelectorAll('style,link[rel=stylesheet]'))).forEach((node: HTMLStyleElement | HTMLLinkElement) => {\n\n            document.body.append(node);\n\n            if (node.tagName === 'LINK') {\n\n                if (node.media === 'print') {\n\n                    return\n                }\n\n                if (node.hasAttribute('media')) {\n\n                    // @ts-ignore\n                    node.setAttribute('data-media', node.media);\n                }\n\n                // @ts-ignore\n                node.media = 'print';\n                // @ts-ignore\n                node.dataset.async = '';\n            }\n        });\n\n        // add data-attribute\n        const style: HTMLStyleElement = document.createElement('style');\n        // @ts-ignore\n        style.dataset.critical = true;\n        const css: string = [...usedFonts.values()].map((entry: FontObject): string => {\n\n                return '@font-face {' + '\\n ' + Object.entries(entry).map((entry: [string, string | {\n                    [key: string]: string\n                }]): string => {\n\n                    return typeof entry[1] == 'string' ? `${entry[0] + ': ' + entry[1]}` : Object.entries(entry[1]).map((entry: [string, string]): string => `${entry[0] + ': ' + entry[1]}`).join(';\\n ') + '\\n}'\n                }).join(';\\n')\n            }).join('\\n') +\n            '\\n' + (<string[]>result.styles).join('\\n');\n\n        if (options.transform != null) {\n\n            await options.transform(css).then((parseResult: TransformResult) => style.textContent = parseResult.code);\n        }\n\n        else {\n\n            style.textContent = css;\n        }\n\n        if (style.innerText.trim() !== '') {\n\n            document.head.insertBefore(style, (<HTMLBaseElement>document.querySelector('base'))?.nextElementSibling);\n        }\n\n        if ((<string[]>result.fonts).length > 0) {\n\n            const script: HTMLScriptElement = document.createElement('script');\n            script.textContent = fontscript(<FontObject[]>result.fonts);\n            document.head.append(script);\n        }\n\n        options?.signal?.removeEventListener('abort', abortSignal);\n\n        const doctype: DocumentType | null = document.doctype;\n\n        result.html = (doctype ? `<!Doctype ${doctype.name}`\n            + (doctype.publicId ? ` PUBLIC \"${doctype.publicId}\"` : '')\n            + (doctype.systemId\n                ? (doctype.publicId ? `` : ` SYSTEM`) + ` \"${doctype.systemId}\"`\n                : ``)\n            + `>` + '\\n' : '') + document.documentElement.outerHTML\n    }\n\n    return result;\n}","/**\n *\n * @param {string[]} content\n * @param {string} filename\n * @param {string} mimetype\n * @return {Promise<string[]>}\n */\nexport async function download(content: Array<string>, filename: string, mimetype: string = 'application/octet-stream; charset=utf-8'): Promise<Array<string>> {\n\n    //\n    const url: string = URL.createObjectURL(new Blob(content, {type: mimetype}));\n    //\n    const a: HTMLAnchorElement = document.createElement('a');\n    document.body.append(a);\n    a.style.display = 'none';\n    a.download = filename;\n    a.href = url;\n\n    //\n    a.dispatchEvent(new MouseEvent('click'));\n    URL.revokeObjectURL(url);\n\n    return content;\n}","import {extract} from \"./critical/extract\";\nimport {download} from \"./file/download\";\nimport {fontscript} from \"./critical/fontscript\";\nimport {CriticalExtractOptions, CriticalResult} from \"./@types\";\n\nasync function extractAndDownload(filename: string = 'critical.css', options: CriticalExtractOptions = {}): Promise<CriticalResult> {\n\n    return extract(options).\n        then(async (content : CriticalResult): Promise<CriticalResult> => download(<string[]>content.styles, filename, 'text/css; charset=utf-8').\n            then(async () => {\n\n                if ((<string[]>content.fonts).length > 0) {\n\n                    // @ts-ignore\n                    return download([fontscript(<string[]>content.fonts)], filename.replace(/\\.css$/, '.js'), 'text/javascript; charset=utf-8');\n                }\n        }).\n        then(() => content)\n    );\n}\n\nexport {extract, fontscript, extractAndDownload as download}"],"names":[],"mappings":"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"}