var critical=function(e){"use strict";function t(e,t){if(e.match(/^['"]?data:/))return e;const r=new URL(t,window.location),n=new URL(e,r);return r.protocol!=n.protocol||r.host!=n.host||n.host!=window.location.host||r.port!=n.port||n.port!=window.location.port||r.port!=n.port||n.protocol!=window.location.protocol?n.toString():n.pathname+n.search+n.hash}function r(e){return"/* font preloader script: "+e.length+' */\n"fonts" in document && '+JSON.stringify([...e],null,1)+".forEach(font => new FontFace(font.fontFamily, font.src, font.properties).load().then(font => document.fonts.add(font)))"}async function n(e={}){const n=window.document,a=window.location,l=new Set,o=["all","print",""],s=[],i=window.innerHeight,c=n.createNodeIterator(n,NodeFilter.SHOW_ELEMENT,{acceptNode:function(e){return NodeFilter.SHOW_ELEMENT}}),f=new Set,p=new Set,u=new Map,d=new WeakMap;let h,m,y,S,g,w=0;for(performance.mark("filterStylesheets"),h=0;h<n.styleSheets.length;h++)if(m=n.styleSheets[h],"print"!=m.media.mediaText&&(""===m.media.mediaText||window.matchMedia(m.media.mediaText).matches))try{y=m.cssRules||m.rules;for(let e=0;e<y.length;e++)s.push({rule:y[e],match:!1})}catch(e){console.error(JSON.stringify({message:e.message,stylesheet:m.href},null,1))}if(performance.measure("filter stylesheets","filterStylesheets"),0===s.length)return[];let x,E=s.length;for(performance.mark("nodeWalking");S=c.nextNode();){if(e?.signal?.aborted)return Promise.reject("Aborted");if(!["SCRIPT","LINK","HEAD","META","TITLE","NOSCRIPT"].includes(S.tagName)&&(w++,g=S.getBoundingClientRect(),g.top<i))for(h=0;h<E;h++)if(!s[h].match)if(d.set(s[h].rule,1),s[h].rule instanceof CSSStyleRule){let e,t=s[h].rule.selectorText;if(t.match(/(^|,|\s)::?((before)|(after))/))e=!0;else{t.match(/::?((before)|(after))/)&&(t=t.replace(/::?((before)|(after))\s*((,)|$)/g,"$5"));try{e=S.matches(t)}catch(r){console.log(`${t} ---- ${s[h].rule.selectorText} `),e=S.matches(s[h].rule.selectorText)}}e&&(s[h].match=!0,s[h].rule.style.getPropertyValue("font-family")&&s[h].rule.style.getPropertyValue("font-family").split(/\s*,\s*/).forEach((e=>"inherit"!=e&&p.add(e.replace(/(['"])([^\1\s]+)\1/,"$2")))))}else if(s[h].rule instanceof CSSMediaRule||s[h].rule instanceof CSSImportRule){if("print"===s[h].rule.media.mediaText||""!==s[h].rule.media.mediaText&&!window.matchMedia(s[h].rule.media.mediaText).matches)continue;try{const e=s[h].rule,t=[],r=e instanceof CSSImportRule?e.styleSheet.cssRules||e.styleSheet.rules:e.cssRules||e.rules;for(let e=0;e<r.length;e++)d.has(r[e])||t.push({rule:r[e],match:!1});t.length>0&&(s.splice.apply(s,[h+1,0].concat(t)),E=s.length)}catch(e){console.error(JSON.stringify({message:e.message,stylesheet:m.href},null,1))}}else s[h].rule instanceof CSSFontFaceRule&&s[h].rule.style.getPropertyValue("font-family")&&s[h].rule.style.getPropertyValue("src")&&f.add(s[h].rule)}performance.measure("node walking","nodeWalking");let b="",T=-1;performance.mark("rulesExtraction");e:for(let e=0;e<E;e++){if(!s[e].match)continue;m=s[e].rule;let r=!1;if(u.has(m.parentStyleSheet)?b&&b!=u.get(m.parentStyleSheet).file&&(r=!0):(u.set(m.parentStyleSheet,{base:(m.parentStyleSheet.href&&m.parentStyleSheet.href.replace(/[?#].*/,"")||a.pathname).replace(/([^/]+)$/,""),file:m.parentStyleSheet.href||"inline #"+ ++T}),r=!0),r)try{console.log("analysing "+u.get(m.parentStyleSheet).file),l.add("/* file: "+u.get(m.parentStyleSheet).file+" */")}catch(e){console.error(JSON.stringify(e.message,null,1)),console.error(JSON.stringify(m?.parentStyleSheet?.href,null,1))}for(b=u.get(m.parentStyleSheet).file,x=m.cssText,"inline"!=b&&(x=x.replace(/url\(([^)%\s]*?)\)/g,(function(e,r){return(r=r.trim()).match(/^['"]?data:/)?e:"url("+t(r=r.replace(/^(['"])([^\1\s]+)\1/,"$2"),u.get(m.parentStyleSheet).base)+")"})));m.parentRule;){if(m=m.parentRule,"print"==m.conditionText)continue e;if(o.includes(m.conditionText)||(x="@media "+m.conditionText+" {"+x+"}"),!m.parentRule)break}if(m.parentStyleSheet){let e=m.parentStyleSheet.media.mediaText;if("print"==e)continue e;o.includes(e)||(x="@media "+e+" {"+x+"}")}l.has(x)&&l.delete(x),l.add(x)}performance.measure("rules extraction","rulesExtraction");const R=new Map;if(e.fonts){let e,r,n,a,l;for(a of(performance.mark("fontsExtraction"),f))if(a.style.getPropertyValue("font-family").split(/\s*,\s*/).some((e=>p.has(e.replace(/(['"])([^\1\s]+)\1/,"$2"))))){for(l={fontFamily:a.style.getPropertyValue("font-family").replace(/(['"])([^\1\s]+)\1/,"$2"),src:a.style.getPropertyValue("src").replace(/(^|[,\s*])local\([^)]+\)\s*,?\s*?/g,"").replace(/url\(([^)%\s]+)\)([^,]*)(,?)\s*/g,((e,r,n,l)=>(r=r.replace(/(['"])([^\1\s]+)\1/,"$2"),u.has(a.parentStyleSheet)||u.set(a.parentStyleSheet,{base:a.parentStyleSheet.href.replace(/([^/]+)$/,""),file:a.parentStyleSheet.href}),"url("+t(r,u.get(a.parentStyleSheet).base)+")"+l))).trim(),properties:{}},e=a.style.length;e--;)r=a.style.item(e),n=a.style.getPropertyValue(r),"font-family"!=r&&"src"!=r&&""!==n&&void 0!==n&&(l.properties[r.replace(/([A-Z])/g,((e,t)=>"-"+t.toLowerCase()))]=n);R.set(JSON.stringify(l),l)}performance.measure("fonts extraction","fontsExtraction")}const N=performance.getEntriesByType("measure").filter((e=>["filter stylesheets","node walking","rules extraction","fonts extraction"].includes(e.name))).map((e=>({name:e.name,duration:(e.duration/1e3).toFixed(3)+"s"}))),k={styles:[...l],fonts:[...R.values()],nodeCount:w,stats:{nodeCount:w,stats:N}};if(e.html){if(!n.querySelector("base")){const e=n.createElement("base");e.href=a.protocol+"//"+a.host+a.pathname,n.head.append(e)}Array.from(n.querySelectorAll("style,link[rel=stylsheet]")).forEach((e=>{if(n.body.append(e),"link"==e.tagName){if("print"==e.media)return;e.hasAttribute("media")&&e.setAttribute("data-media",e.media),e.media="print",e.addEventListener("load",(function(){e.hasAttribute("data-media")?(e.media=e.dataset.media,e.removeAttribute("data-media")):e.removeAttribute("media")}),{once:!0})}}));const e=n.createElement("style"),t=n.createElement("script");e.textContent=k.styles.join("\n"),n.head.append(e),k.fonts.length>0&&(t.textContent=r(k.fonts),n.head.append(t)),(n.currentScript||n.scripts[n.scripts.length-1]).remove(),k.html=n.documentElement.outerHTML}return k}async function a(e,t,r="application/octet-stream; charset=utf-8"){const n=URL.createObjectURL(new Blob(e,{type:r})),a=document.createElement("a");return document.body.append(a),a.style.display="none",a.download=t,a.href=n,a.dispatchEvent(new MouseEvent("click")),URL.revokeObjectURL(n),e}return e.download=async function(e="critical.css",t={}){return n(t).then((async t=>(await a(t.styles,e,"text/css; charset=utf-8").then((async()=>{t.fonts.length>0&&await a([r(t.fonts)],e.replace(/\.css$/,".js"),"text/javascript; charset=utf-8")})),t)))},e.extract=n,e.fontscript=r,Object.defineProperty(e,"__esModule",{value:!0}),e}({});
