var critical=function(e){"use strict";function t(e,t){if(e.match(/^['"]?data:/))return e;const n=new URL(t,window.location),r=new URL(e,n);return n.protocol!=r.protocol||n.host!=r.host||r.host!=window.location.host||n.port!=r.port||r.port!=window.location.port||n.port!=r.port||r.protocol!=window.location.protocol?r.toString():r.pathname+r.search+r.hash}function n(e){return"/* font preloader script: "+e.length+' */\n"fonts" in document && '+JSON.stringify([...e],null,1)+".forEach(font => new FontFace(font.fontFamily, font.src, font.properties).load().then(font => document.fonts.add(font)))"}async function r(e={}){const r=window.document,a=window.location,o=new Set,l=["all","print",""],s=[],i=window.innerHeight,c=r.createNodeIterator(r,NodeFilter.SHOW_ELEMENT,{acceptNode:function(e){return NodeFilter.SHOW_ELEMENT}}),f=new Set,d=new Set,u=new Map,p=new WeakMap;let m,h,y,S,g,w=0;for(performance.mark("filterStylesheets"),m=0;m<r.styleSheets.length;m++)if(h=r.styleSheets[m],"print"!=h.media.mediaText&&(""===h.media.mediaText||window.matchMedia(h.media.mediaText).matches))try{y=h.cssRules||h.rules;for(let e=0;e<y.length;e++)s.push({rule:y[e],match:!1})}catch(e){console.error(JSON.stringify({message:e.message,stylesheet:h.href},null,1))}if(performance.measure("filter stylesheets","filterStylesheets"),0===s.length)return[];let x,b=s.length;for(performance.mark("nodeWalking");S=c.nextNode();){if(e?.signal?.aborted)return Promise.reject("Aborted");if(!["SCRIPT","LINK","HEAD","META","TITLE","NOSCRIPT"].includes(S.tagName)&&(w++,g=S.getBoundingClientRect(),g.top<i))for(m=0;m<b;m++)if(!s[m].match)if(p.set(s[m].rule,1),s[m].rule instanceof CSSStyleRule){let e,t=s[m].rule.selectorText;if(t.match(/(^|,|\s)::?((before)|(after))/))e=!0;else{t.match(/::?((before)|(after))/)&&(t=t.replace(/::?((before)|(after))\s*((,)|$)/g,"$5"));try{e=S.matches(t)}catch(n){console.log(`${t} ---- ${s[m].rule.selectorText} `),e=S.matches(s[m].rule.selectorText)}}e&&(s[m].match=!0,s[m].rule.style.getPropertyValue("font-family")&&s[m].rule.style.getPropertyValue("font-family").split(/\s*,\s*/).forEach((e=>"inherit"!=e&&d.add(e.replace(/(['"])([^\1\s]+)\1/,"$2")))))}else if(s[m].rule instanceof CSSMediaRule||s[m].rule instanceof CSSImportRule){if("print"===s[m].rule.media.mediaText||""!==s[m].rule.media.mediaText&&!window.matchMedia(s[m].rule.media.mediaText).matches)continue;try{const e=s[m].rule,t=[],n=e instanceof CSSImportRule?e.styleSheet.cssRules||e.styleSheet.rules:e.cssRules||e.rules;for(let e=0;e<n.length;e++)p.has(n[e])||t.push({rule:n[e],match:!1});t.length>0&&(s.splice.apply(s,[m+1,0].concat(t)),b=s.length)}catch(e){console.error(JSON.stringify({message:e.message,stylesheet:h.href},null,1))}}else s[m].rule instanceof CSSFontFaceRule&&s[m].rule.style.getPropertyValue("font-family")&&s[m].rule.style.getPropertyValue("src")&&f.add(s[m].rule)}performance.measure("node walking","nodeWalking");let E="",T=-1;performance.mark("rulesExtraction");e:for(let e=0;e<b;e++){if(!s[e].match)continue;h=s[e].rule;let n=!1;if(u.has(h.parentStyleSheet)?E&&E!=u.get(h.parentStyleSheet).file&&(n=!0):(u.set(h.parentStyleSheet,{base:(h.parentStyleSheet.href&&h.parentStyleSheet.href.replace(/[?#].*/,"")||a.pathname).replace(/([^/]+)$/,""),file:h.parentStyleSheet.href||"inline #"+ ++T}),n=!0),n)try{console.log("analysing "+u.get(h.parentStyleSheet).file),o.add("/* file: "+u.get(h.parentStyleSheet).file+" */")}catch(e){console.error(JSON.stringify(e.message,null,1)),console.error(JSON.stringify(h?.parentStyleSheet?.href,null,1))}for(E=u.get(h.parentStyleSheet).file,x=h.cssText,"inline"!=E&&(x=x.replace(/url\(([^)%\s]*?)\)/g,(function(e,n){return(n=n.trim()).match(/^['"]?data:/)?e:"url("+t(n=n.replace(/^(['"])([^\1\s]+)\1/,"$2"),u.get(h.parentStyleSheet).base)+")"})));h.parentRule;){if(h=h.parentRule,"print"==h.conditionText)continue e;if(l.includes(h.conditionText)||(x="@media "+h.conditionText+" {"+x+"}"),!h.parentRule)break}if(h.parentStyleSheet){let e=h.parentStyleSheet.media.mediaText;if("print"==e)continue e;l.includes(e)||(x="@media "+e+" {"+x+"}")}o.has(x)&&o.delete(x),o.add(x)}performance.measure("rules extraction","rulesExtraction");const R=new Map;if(e.fonts){let e,n,r,a,o;for(a of(performance.mark("fontsExtraction"),f))if(a.style.getPropertyValue("font-family").split(/\s*,\s*/).some((e=>d.has(e.replace(/(['"])([^\1\s]+)\1/,"$2"))))){for(o={fontFamily:a.style.getPropertyValue("font-family").replace(/(['"])([^\1\s]+)\1/,"$2"),src:a.style.getPropertyValue("src").replace(/(^|[,\s*])local\([^)]+\)\s*,?\s*?/g,"").replace(/url\(([^)%\s]+)\)([^,]*)(,?)\s*/g,((e,n,r,o)=>(n=n.replace(/(['"])([^\1\s]+)\1/,"$2"),u.has(a.parentStyleSheet)||u.set(a.parentStyleSheet,{base:a.parentStyleSheet.href.replace(/([^/]+)$/,""),file:a.parentStyleSheet.href}),"url("+t(n,u.get(a.parentStyleSheet).base)+")"+o))).trim(),properties:{}},e=a.style.length;e--;)n=a.style.item(e),r=a.style.getPropertyValue(n),"font-family"!=n&&"src"!=n&&""!==r&&void 0!==r&&(o.properties[n.replace(/([A-Z])/g,((e,t)=>"-"+t.toLowerCase()))]=r);R.set(JSON.stringify(o),o)}performance.measure("fonts extraction","fontsExtraction")}const C=performance.getEntriesByType("measure").filter((e=>["filter stylesheets","node walking","rules extraction","fonts extraction"].includes(e.name))).map((e=>({name:e.name,duration:(e.duration/1e3).toFixed(3)+"s"}))),N={styles:[...o],fonts:[...R.values()],nodeCount:w,stats:{nodeCount:w,stats:C}};if(e.html){if(!r.querySelector("base")){const e=r.createElement("base");e.href=a.protocol+"//"+a.host+a.pathname,r.head.insertBefore(e,r.querySelector("meta[charset]")?.nextElementSibling||r.head.firstChild)}Array.from(r.querySelectorAll("style,link[rel=stylesheet]")).forEach((e=>{if(r.body.append(e),"LINK"==e.tagName){if("print"==e.media)return;e.hasAttribute("media")&&e.setAttribute("data-media",e.media),e.media="print",e.dataset.async=""}}));const e=r.createElement("script");e.textContent="\n        window.addEventListener('DOMContentLoaded', () => Array.from(document.querySelectorAll('link[data-async]')).forEach(node => {\n\n                if(!node.hasAttribute('data-media')) {\n                    node.removeAttribute('media');\n                }\n                else {\n                    node.media=node.dataset.media;\n                    node.removeAttribute('data-media')\n                }\n                \n                node.removeAttribute('data-async');\n        }))",r.head.append(e);const t=r.createElement("style");if(t.dataset.critical=!0,t.textContent=N.styles.join("\n"),""!==t.textContent.trim()&&r.head.insertBefore(t,r.querySelector("base")?.nextElementSibling),N.fonts.length>0){const e=r.createElement("script");e.textContent=n(N.fonts),r.head.append(e)}const o=r.doctype;N.html=`<!Doctype ${o.name}`+(o.publicId?` PUBLIC "${o.publicId}"`:"")+(o.systemId?(o.publicId?"":" SYSTEM")+` "${o.systemId}"`:"")+">\n"+r.documentElement.outerHTML}return N}async function a(e,t,n="application/octet-stream; charset=utf-8"){const r=URL.createObjectURL(new Blob(e,{type:n})),a=document.createElement("a");return document.body.append(a),a.style.display="none",a.download=t,a.href=r,a.dispatchEvent(new MouseEvent("click")),URL.revokeObjectURL(r),e}return e.download=async function(e="critical.css",t={}){return r(t).then((async t=>(await a(t.styles,e,"text/css; charset=utf-8").then((async()=>{t.fonts.length>0&&await a([n(t.fonts)],e.replace(/\.css$/,".js"),"text/javascript; charset=utf-8")})),t)))},e.extract=r,e.fontscript=n,Object.defineProperty(e,"__esModule",{value:!0}),e}({});
