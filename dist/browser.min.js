var critical=function(e){"use strict";function t(e,t){if(e.match(/^['"]?data:/))return e;const r=new URL(t,window.location),n=new URL(e,r);return r.protocol!=n.protocol||r.host!=n.host||n.host!=window.location.host||r.port!=n.port||n.port!=window.location.port||r.port!=n.port||n.protocol!=window.location.protocol?n.toString():n.pathname+n.search+n.hash}function r(e){return"/* font preloader script: "+e.length+' */\n"fonts" in document && '+JSON.stringify([...e],null,1)+".forEach(font => new FontFace(font.fontFamily, font.src, font.properties).load().then(font => document.fonts.add(font)))"}async function n(e={}){const n=window.document,a=window.location,l=new Set,o=["all","print",""],s=[],i=window.innerHeight,c=n.createNodeIterator(n,NodeFilter.SHOW_ELEMENT,{acceptNode:function(e){return NodeFilter.SHOW_ELEMENT}}),f=new Set,u=new Set,p=new Map,d=new WeakMap;let m,h,y,S,g,w=0;for(performance.mark("filterStylesheets"),m=0;m<n.styleSheets.length;m++)if(h=n.styleSheets[m],"print"!=h.media.mediaText&&(""===h.media.mediaText||window.matchMedia(h.media.mediaText).matches))try{y=h.cssRules||h.rules;for(let e=0;e<y.length;e++)s.push({rule:y[e],match:!1})}catch(e){console.error(JSON.stringify({message:e.message,stylesheet:h.href},null,1))}if(performance.measure("filter stylesheets","filterStylesheets"),0===s.length)return[];let x,b=s.length;for(performance.mark("nodeWalking");S=c.nextNode();){if(e?.signal?.aborted)return Promise.reject("Aborted");if(!["SCRIPT","LINK","HEAD","META","TITLE","NOSCRIPT"].includes(S.tagName)&&(w++,g=S.getBoundingClientRect(),g.top<i))for(m=0;m<b;m++)if(!s[m].match)if(d.set(s[m].rule,1),s[m].rule instanceof CSSStyleRule){let e,t=s[m].rule.selectorText;if(t.match(/(^|,|\s)::?((before)|(after))/))e=!0;else{t.match(/::?((before)|(after))/)&&(t=t.replace(/::?((before)|(after))\s*((,)|$)/g,"$5"));try{e=S.matches(t)}catch(r){console.log(`${t} ---- ${s[m].rule.selectorText} `),e=S.matches(s[m].rule.selectorText)}}e&&(s[m].match=!0,s[m].rule.style.getPropertyValue("font-family")&&s[m].rule.style.getPropertyValue("font-family").split(/\s*,\s*/).forEach((e=>"inherit"!=e&&u.add(e.replace(/(['"])([^\1\s]+)\1/,"$2")))))}else if(s[m].rule instanceof CSSMediaRule||s[m].rule instanceof CSSImportRule){if("print"===s[m].rule.media.mediaText||""!==s[m].rule.media.mediaText&&!window.matchMedia(s[m].rule.media.mediaText).matches)continue;try{const e=s[m].rule,t=[],r=e instanceof CSSImportRule?e.styleSheet.cssRules||e.styleSheet.rules:e.cssRules||e.rules;for(let e=0;e<r.length;e++)d.has(r[e])||t.push({rule:r[e],match:!1});t.length>0&&(s.splice.apply(s,[m+1,0].concat(t)),b=s.length)}catch(e){console.error(JSON.stringify({message:e.message,stylesheet:h.href},null,1))}}else s[m].rule instanceof CSSFontFaceRule&&s[m].rule.style.getPropertyValue("font-family")&&s[m].rule.style.getPropertyValue("src")&&f.add(s[m].rule)}performance.measure("node walking","nodeWalking");let E="",T=-1;performance.mark("rulesExtraction");e:for(let e=0;e<b;e++){if(!s[e].match)continue;h=s[e].rule;let r=!1;if(p.has(h.parentStyleSheet)?E&&E!=p.get(h.parentStyleSheet).file&&(r=!0):(p.set(h.parentStyleSheet,{base:(h.parentStyleSheet.href&&h.parentStyleSheet.href.replace(/[?#].*/,"")||a.pathname).replace(/([^/]+)$/,""),file:h.parentStyleSheet.href||"inline #"+ ++T}),r=!0),r)try{console.log("analysing "+p.get(h.parentStyleSheet).file),l.add("/* file: "+p.get(h.parentStyleSheet).file+" */")}catch(e){console.error(JSON.stringify(e.message,null,1)),console.error(JSON.stringify(h?.parentStyleSheet?.href,null,1))}for(E=p.get(h.parentStyleSheet).file,x=h.cssText,"inline"!=E&&(x=x.replace(/url\(([^)%\s]*?)\)/g,(function(e,r){return(r=r.trim()).match(/^['"]?data:/)?e:"url("+t(r=r.replace(/^(['"])([^\1\s]+)\1/,"$2"),p.get(h.parentStyleSheet).base)+")"})));h.parentRule;){if(h=h.parentRule,"print"==h.conditionText)continue e;if(o.includes(h.conditionText)||(x="@media "+h.conditionText+" {"+x+"}"),!h.parentRule)break}if(h.parentStyleSheet){let e=h.parentStyleSheet.media.mediaText;if("print"==e)continue e;o.includes(e)||(x="@media "+e+" {"+x+"}")}l.has(x)&&l.delete(x),l.add(x)}performance.measure("rules extraction","rulesExtraction");const R=new Map;if(e.fonts){let e,r,n,a,l;for(a of(performance.mark("fontsExtraction"),f))if(a.style.getPropertyValue("font-family").split(/\s*,\s*/).some((e=>u.has(e.replace(/(['"])([^\1\s]+)\1/,"$2"))))){for(l={fontFamily:a.style.getPropertyValue("font-family").replace(/(['"])([^\1\s]+)\1/,"$2"),src:a.style.getPropertyValue("src").replace(/(^|[,\s*])local\([^)]+\)\s*,?\s*?/g,"").replace(/url\(([^)%\s]+)\)([^,]*)(,?)\s*/g,((e,r,n,l)=>(r=r.replace(/(['"])([^\1\s]+)\1/,"$2"),p.has(a.parentStyleSheet)||p.set(a.parentStyleSheet,{base:a.parentStyleSheet.href.replace(/([^/]+)$/,""),file:a.parentStyleSheet.href}),"url("+t(r,p.get(a.parentStyleSheet).base)+")"+l))).trim(),properties:{}},e=a.style.length;e--;)r=a.style.item(e),n=a.style.getPropertyValue(r),"font-family"!=r&&"src"!=r&&""!==n&&void 0!==n&&(l.properties[r.replace(/([A-Z])/g,((e,t)=>"-"+t.toLowerCase()))]=n);R.set(JSON.stringify(l),l)}performance.measure("fonts extraction","fontsExtraction")}const N=performance.getEntriesByType("measure").filter((e=>["filter stylesheets","node walking","rules extraction","fonts extraction"].includes(e.name))).map((e=>({name:e.name,duration:(e.duration/1e3).toFixed(3)+"s"}))),C={styles:[...l],fonts:[...R.values()],nodeCount:w,stats:{nodeCount:w,stats:N}};if(e.html){if(!n.querySelector("base")){const e=n.createElement("base");e.href=a.protocol+"//"+a.host+a.pathname,n.head.insertBefore(e,n.querySelector("meta[charset]")?.nextElementSibling||n.head.firstChild)}Array.from(n.querySelectorAll("style,link[rel=stylsheet]")).forEach((e=>{if(n.body.append(e),"link"==e.tagName){if("print"==e.media)return;e.hasAttribute("media")&&e.setAttribute("data-media",e.media),e.media="print",e.addEventListener("load",(function(){e.hasAttribute("data-media")?(e.media=e.dataset.media,e.removeAttribute("data-media")):e.removeAttribute("media")}),{once:!0})}}));const e=n.createElement("style"),t=n.createElement("script");e.dataset.critical=!0,e.textContent=C.styles.join("\n"),n.head.append(e),C.fonts.length>0&&(t.textContent=r(C.fonts),n.head.append(t)),(n.currentScript||n.scripts[n.scripts.length-1]).remove();const l=n.doctype;C.html=`<!Doctype ${l.name}`+(l.publicId?` PUBLIC "${l.publicId}"`:"")+(l.systemId?(l.publicId?"":" SYSTEM")+` "${l.systemId}"`:"")+">\n"+n.documentElement.outerHTML}return C}async function a(e,t,r="application/octet-stream; charset=utf-8"){const n=URL.createObjectURL(new Blob(e,{type:r})),a=document.createElement("a");return document.body.append(a),a.style.display="none",a.download=t,a.href=n,a.dispatchEvent(new MouseEvent("click")),URL.revokeObjectURL(n),e}return e.download=async function(e="critical.css",t={}){return n(t).then((async t=>(await a(t.styles,e,"text/css; charset=utf-8").then((async()=>{t.fonts.length>0&&await a([r(t.fonts)],e.replace(/\.css$/,".js"),"text/javascript; charset=utf-8")})),t)))},e.extract=n,e.fontscript=r,Object.defineProperty(e,"__esModule",{value:!0}),e}({});
