var critical=function(e){"use strict";function t(e,t){let r=e.matchesSelector||e.webkitMatchesSelector||e.mozMatchesSelector||e.msMatchesSelector;if(r)try{return r.call(e,t)}catch(e){return!1}else{let r=e.ownerDocument.querySelectorAll(t),n=r.length;for(;n&&n--;)if(r[n]===e)return!0}return!1}function r(e,t){if(e.match(/^['"]?data:/))return e;const r=new URL(t,window.location),n=new URL(e,r);return r.protocol!=n.protocol||r.host!=n.host||n.host!=window.location.host||r.port!=n.port||n.port!=window.location.port||r.port!=n.port||n.protocol!=window.location.protocol?n.toString():n.pathname+n.search+n.hash}async function n(e={}){e=Object.assign({fonts:!0},e);const n=new Set,a=["all","print",""],o=[],l=window.innerHeight,s=document.createNodeIterator(document,NodeFilter.SHOW_ELEMENT,{acceptNode:function(e){return NodeFilter.SHOW_ELEMENT}}),i=new Set,c=new Set,f=new Map;let u,p,h,m,d=0;for(performance.mark("filterStylesheets"),u=0;u<document.styleSheets.length;u++)if(p=document.styleSheets[u],"print"!=p.media.mediaText&&(""===p.media.mediaText||window.matchMedia(p.media.mediaText).matches))try{h=p.cssRules||p.rules;for(let e=0;e<h.length;e++)o.push({rule:h[e],match:!1})}catch(e){console.error(JSON.stringify({message:e.message,stylesheet:p.href},null,1))}if(performance.measure("filter stylesheets","filterStylesheets"),0===o.length)return[];let y,S=o.length;for(performance.mark("nodeWalking");m=s.nextNode();){if(["SCRIPT","LINK","HEAD","META","TITLE","NOSCRIPT"].includes(m.tagName))continue;if(d++,m.getBoundingClientRect().top<l)for(u=0;u<S;u++)if(!o[u].match)if(o[u].rule instanceof CSSStyleRule)t(m,o[u].rule.selectorText)&&(o[u].match=!0,o[u].rule.style.getPropertyValue("font-family")&&o[u].rule.style.getPropertyValue("font-family").split(/\s*,\s*/).forEach((e=>"inherit"!=e&&c.add(e.replace(/(['"])([^\1\s]+)\1/,"$2")))));else if(o[u].rule instanceof CSSMediaRule||o[u].rule instanceof CSSImportRule){if(""!==o[u].rule.media.mediaText&&!window.matchMedia(o[u].rule.media.mediaText).matches)continue;const e=[],t=o[u].rule.cssRules||o[u].rule.rules;let r;for(r=0;r<t.length;r++)e.push({rule:t[r],match:!1});e.unshift(u+1,0),o.splice.apply(o,e),S=o.length,o[u].rule instanceof CSSImportRule&&n.add("/* @import: "+o[u].rule.href+" from "+(o[u].rule.parentStyleSheet.href||`inline #${w}`)+" */")}else o[u].rule instanceof CSSFontFaceRule&&o[u].rule.style.getPropertyValue("font-family")&&o[u].rule.style.getPropertyValue("src")&&i.add(o[u].rule)}performance.measure("node walking","nodeWalking");let g="",w=-1;performance.mark("rulesExtraction");e:for(let e=0;e<S;e++){if(!o[e].match)continue;p=o[e].rule;let t=!1;if(f.has(p.parentStyleSheet)?g&&g!=f.get(p.parentStyleSheet).file&&(t=!0):(f.set(p.parentStyleSheet,{base:(p.parentStyleSheet.href&&p.parentStyleSheet.href.replace(/[?#].*/,"")||location.pathname).replace(/([^/]+)$/,""),file:p.parentStyleSheet.href||"inline #"+ ++w}),t=!0),t)try{console.log("analysing "+f.get(p.parentStyleSheet).file),n.add("/* file: "+f.get(p.parentStyleSheet).file+" */")}catch(e){console.error(e.message),console.error(p.parentStyleSheet)}for(g=f.get(p.parentStyleSheet).file,y=p.cssText,"inline"!=g&&(y=y.replace(/url\(([^)%\s]*?)\)/g,(function(e,t){return(t=t.trim()).match(/^['"]?data:/)?e:"url("+r(t=t.replace(/^(['"])([^\1\s]+)\1/,"$2"),f.get(p.parentStyleSheet).base)+")"})));p.parentRule;){if(p=p.parentRule,"print"==p.conditionText)continue e;if(a.includes(p.conditionText)||(y="@media "+p.conditionText+" {"+y+"}"),!p.parentRule)break}if(p.parentStyleSheet){let e=p.parentStyleSheet.media.mediaText;if("print"==e)continue e;a.includes(e)||(y="@media "+e+" {"+y+"}")}n.has(y)&&n.delete(y),n.add(y)}performance.measure("rules extraction","rulesExtraction");const x=new Map;if(e.fonts){let e,t,n,a,o;for(a of(performance.mark("fontsExtraction"),i))if(a.style.getPropertyValue("font-family").split(/\s*,\s*/).some((e=>c.has(e.replace(/(['"])([^\1\s]+)\1/,"$2"))))){for(o={fontFamily:a.style.getPropertyValue("font-family").replace(/(['"])([^\1\s]+)\1/,"$2"),src:a.style.getPropertyValue("src").replace(/(^|[,\s*])local\([^)]+\)\s*,?\s*?/g,"").replace(/url\(([^)%\s]+)\)([^,]*)(,?)\s*/g,((e,t,n,o)=>(t=t.replace(/(['"])([^\1\s]+)\1/,"$2"),f.has(a.parentStyleSheet)||f.set(a.parentStyleSheet,{base:a.parentStyleSheet.href.replace(/([^/]+)$/,""),file:a.parentStyleSheet.href}),"url("+r(t,f.get(a.parentStyleSheet).base)+")"+o))).trim(),properties:{}},e=a.style.length;e--;)t=a.style.item(e),n=a.style.getPropertyValue(t),"font-family"!=t&&"src"!=t&&""!==n&&void 0!==n&&(o.properties[t.replace(/([A-Z])/g,((e,t)=>"-"+t.toLowerCase()))]=n);x.set(JSON.stringify(o),o)}performance.measure("fonts extraction","fontsExtraction")}const E=performance.getEntriesByType("measure").filter((e=>["filter stylesheets","node walking","rules extraction","fonts extraction"].includes(e.name))).map((e=>({name:e.name,duration:(e.duration/1e3).toFixed(3)+"s"})));return{styles:[...n],fonts:[...x.values()],nodeCount:d,stats:{nodeCount:d,stats:E}}}async function a(e,t,r="application/octet-stream; charset=utf-8"){const n=URL.createObjectURL(new Blob(e,{type:r})),a=document.createElement("a");return document.body.append(a),a.style.display="none",a.download=t,a.href=n,a.dispatchEvent(new MouseEvent("click")),URL.revokeObjectURL(n),e}function o(e){return"/* font preloader script: "+e.length+' */\n"fonts" in document && '+JSON.stringify([...e],null,1)+".forEach(font => new FontFace(font.fontFamily, font.src, font.properties).load().then(font => document.fonts.add(font)))"}return e.download=async function(e="critical.css",t={}){return n(t).then((async t=>(await a(t.styles,e,"text/css; charset=utf-8").then((async()=>{t.fonts.length>0&&await a([o(t.fonts)],e.replace(/\.css$/,".js"),"text/javascript; charset=utf-8")})),t)))},e.extract=n,e.fontscript=o,Object.defineProperty(e,"__esModule",{value:!0}),e}({});
