var critical=function(e){"use strict";function t(e,t){if(e.match(/^['"]?data:/))return e;const n=new URL(t,window.location),r=new URL(e,n);return n.protocol!=r.protocol||n.host!=r.host||r.host!=window.location.host||n.port!=r.port||r.port!=window.location.port||n.port!=r.port||r.protocol!=window.location.protocol?r.toString():r.pathname+r.search+r.hash}function n(e){return"/* font preloader script: "+e.length+' */\n"fonts" in document && '+JSON.stringify([...e],null,1)+".forEach(font => new FontFace(font.fontFamily, font.src, font.properties).load().then(font => document.fonts.add(font)))"}function r(e){let t,n="";for(let r=0;r<e.length;r++)t=e.charCodeAt(r),n+=t>255?"\\"+t.toString(16):e[r];return n}async function a(e={}){const a=window.document,o=window.location,l=new Set,s=["all","print",""],i=[],c=window.innerHeight,f=a.createNodeIterator(a,NodeFilter.SHOW_ELEMENT,{acceptNode:()=>NodeFilter.SHOW_ELEMENT}),u=new Set,d=new Set,p=new Map,m=new WeakMap,h=new WeakMap;let y,S,g,w,b,x=0;for(performance.mark("filterStylesheets"),y=0;y<a.styleSheets.length;y++)if(S=a.styleSheets[y],"print"!==S.media.mediaText&&(""===S.media.mediaText||window.matchMedia(S.media.mediaText).matches))try{g=S.cssRules||S.rules;for(let e=0;e<g.length;e++)i.push({rule:g[e],match:!1})}catch(e){console.error(JSON.stringify({message:e.message,stylesheet:S.href},null,1))}if(performance.measure("filter stylesheets","filterStylesheets"),0===i.length)return{styles:[],fonts:[],stats:{}};let E,C=i.length;for(performance.mark("nodeWalking");w=f.nextNode();){if(e&&e.signal&&e.signal.aborted)return Promise.reject("Aborted");["SCRIPT","LINK","HEAD","META","TITLE","NOSCRIPT"].includes(w.tagName)||(x++,b=w.getBoundingClientRect(),b.top<c&&h.set(w,1))}for(y=0;y<C;y++)if(!i[y].match&&!m.has(i[y].rule))if(m.set(i[y].rule,1),i[y].rule instanceof CSSStyleRule){let e,t=i[y].rule.selectorText;if(t.match(/(^|,|\s)::?((before)|(after))/))e=!0;else{t.match(/::?((before)|(after))/)&&(t=t.replace(/::?((before)|(after))\s*((,)|$)/g,"$5"));try{e=h.has(a.querySelector(t))}catch(t){e=h.has(a.querySelector(i[y].rule.selectorText))}}e&&(i[y].match=!0,i[y].rule.style.getPropertyValue("font-family")&&i[y].rule.style.getPropertyValue("font-family").split(/\s*,\s*/).forEach((e=>"inherit"!==e&&d.add(e.replace(/(['"])([^\1\s]+)\1/,"$2")))))}else if(i[y].rule instanceof CSSMediaRule||i[y].rule instanceof CSSImportRule||i[y].rule instanceof CSSConditionRule){if((i[y].rule instanceof CSSMediaRule||i[y].rule instanceof CSSImportRule)&&("print"===i[y].rule.media.mediaText||""!==i[y].rule.media.mediaText&&!window.matchMedia(i[y].rule.media.mediaText).matches))continue;try{const e=i[y].rule,t=[],n=e instanceof CSSImportRule?e.styleSheet.cssRules||e.styleSheet.rules:e.cssRules||e.rules;for(let e=0;e<n.length;e++)m.has(n[e])||t.push({rule:n[e],match:!1});t.length>0&&(i.splice.apply(i,[y+1,0].concat(t)),C=i.length)}catch(e){console.error(JSON.stringify({message:e.message,stylesheet:S.href},null,1))}}else i[y].rule instanceof CSSFontFaceRule&&i[y].rule.style.getPropertyValue("font-family")&&i[y].rule.style.getPropertyValue("src")&&u.add(i[y].rule);performance.measure("node walking","nodeWalking");let R="",T=-1;performance.mark("rulesExtraction");e:for(let e=0;e<C;e++){if(!i[e].match)continue;S=i[e].rule;let n=!1;if(p.has(S.parentStyleSheet)?R&&R!==p.get(S.parentStyleSheet).file&&(n=!0):(p.set(S.parentStyleSheet,{base:(S.parentStyleSheet.href&&S.parentStyleSheet.href.replace(/[?#].*/,"")||o.pathname).replace(/([^/]+)$/,""),file:S.parentStyleSheet.href||"inline style #"+ ++T}),n=!0),n)try{console.log("analysing "+p.get(S.parentStyleSheet).file),l.add("/* file: "+p.get(S.parentStyleSheet).file+" */")}catch(e){console.error(JSON.stringify(e.message,null,1)),console.error(JSON.stringify(S?.parentStyleSheet?.href,null,1))}for(R=p.get(S.parentStyleSheet).file,E=S.cssText,"inline"!==R&&(E=E.replace(/url\(([^)%\s]*?)\)/g,(function(e,n){return(n=n.trim()).match(/^['"]?data:/)?e:"url("+t(n=n.replace(/^(['"])([^\1\s]+)\1/,"$2"),p.get(S.parentStyleSheet).base)+")"})));S.parentRule;){if(S=S.parentRule,"print"==S.conditionText)continue e;if(s.includes(S.conditionText)||(E="@"+S.constructor.name.replace(/^CSS(.*?)Rule/,"$1").toLowerCase()+" "+S.conditionText+" {"+E+"}"),!S.parentRule)break}if(S.parentStyleSheet){let e=S.parentStyleSheet.media.mediaText;if("print"===e)continue e;E="@media "+e+" {"+E+"}"}l.has(E)&&l.delete(E),l.add(E)}performance.measure("rules extraction","rulesExtraction");const N=new Map;if(e.fonts){let e,n,r,a,o,l;for(a of(performance.mark("fontsExtraction"),u))if(a.style.getPropertyValue("font-family").split(/\s*,\s*/).some((e=>d.has(e.replace(/(['"])([^\1\s]+)\1/,"$2"))))){if(l=a.style.getPropertyValue("src"),!l)continue;for(o={fontFamily:a.style.getPropertyValue("font-family").replace(/(['"])([^\1\s]+)\1/,"$2"),src:l.replace(/(^|[,\s*])local\([^)]+\)\s*,?\s*?/g,"").replace(/url\(([^)%\s]+)\)([^,]*)(,?)\s*/g,((e,n,r,o)=>{if(n=n.replace(/(['"])([^\1\s]+)\1/,"$2"),!p.has(a.parentStyleSheet)){if(!a.parentStyleSheet.href)return e;p.set(a.parentStyleSheet,{base:a.parentStyleSheet.href.replace(/([^/]+)$/,""),file:a.parentStyleSheet.href})}return"url("+t(n,p.get(a.parentStyleSheet).base)+")"+o})).trim(),properties:{}},e=a.style.length;e--;)n=a.style.item(e),r=a.style.getPropertyValue(n),"font-family"!==n&&"src"!==n&&""!==r&&void 0!==r&&(o.properties[n.replace(/([A-Z])/g,((e,t)=>"-"+t.toLowerCase()))]=r);N.set(JSON.stringify(o),o)}performance.measure("fonts extraction","fontsExtraction")}const L=performance.getEntriesByType("measure").filter((e=>["filter stylesheets","node walking","rules extraction","fonts extraction"].includes(e.name))).map((e=>({name:e.name,duration:(e.duration/1e3).toFixed(3)+"s"}))),A={styles:[...l].map(r),fonts:[...N.values()],nodeCount:x,stats:{nodeCount:x,stats:L}};if(e.html){if(!a.querySelector("base")){const e=a.createElement("base");e.href=o.protocol+"//"+o.host+o.pathname,a.head.insertBefore(e,a.querySelector("meta[charset]")?.nextElementSibling||a.head.firstChild)}if(!a.querySelector("meta[charset]")){const e=a.createElement("meta");e.setAttribute("charset","utf-8"),a.head.insertBefore(e,a.head.firstChild)}Array.from(a.querySelectorAll("style,link[rel=stylesheet]")).forEach((e=>{if(a.body.append(e),"LINK"===e.tagName){if("print"===e.media)return;e.hasAttribute("media")&&e.setAttribute("data-media",e.media),e.media="print",e.dataset.async=""}}));const e=a.createElement("script");e.textContent="\n        window.addEventListener('DOMContentLoaded', () => Array.from(document.querySelectorAll('link[data-async]')).forEach(node => {\n\n                if(!node.hasAttribute('data-media')) {\n                    node.removeAttribute('media');\n                }\n                else {\n                    node.media=node.dataset.media;\n                    node.removeAttribute('data-media')\n                }\n                \n                node.removeAttribute('data-async');\n        }))",a.head.append(e);const t=a.createElement("style");if(t.dataset.critical=!0,t.textContent=[...N.values()].map((e=>"@font-face {\n "+Object.entries(e).map((e=>"string"==typeof e[1]?""+(e[0]+": "+e[1]):Object.entries(e[1]).map((e=>""+(e[0]+": "+e[1]))).join(";\n ")+"\n}")).join(";\n"))).join("\n")+"\n"+A.styles.map(r).join("\n"),""!==t.textContent.trim()&&a.head.insertBefore(t,a.querySelector("base")?.nextElementSibling),A.fonts.length>0){const e=a.createElement("script");e.textContent=n(A.fonts),a.head.append(e)}const l=a.doctype;A.html=`<!Doctype ${l.name}`+(l.publicId?` PUBLIC "${l.publicId}"`:"")+(l.systemId?(l.publicId?"":" SYSTEM")+` "${l.systemId}"`:"")+">\n"+a.documentElement.outerHTML}return A}async function o(e,t,n="application/octet-stream; charset=utf-8"){const r=URL.createObjectURL(new Blob(e,{type:n})),a=document.createElement("a");return document.body.append(a),a.style.display="none",a.download=t,a.href=r,a.dispatchEvent(new MouseEvent("click")),URL.revokeObjectURL(r),e}return e.download=async function(e="critical.css",t={}){return a(t).then((async t=>(await o(t.styles,e,"text/css; charset=utf-8").then((async()=>{t.fonts.length>0&&await o([n(t.fonts)],e.replace(/\.css$/,".js"),"text/javascript; charset=utf-8")})),t)))},e.extract=a,e.fontscript=n,Object.defineProperty(e,"__esModule",{value:!0}),e}({});
